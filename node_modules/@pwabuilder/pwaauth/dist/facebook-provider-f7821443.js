class e{constructor(e){this.appId=e}signIn(){return this.appendFacebookScript().then(()=>this.initFacebookSdk()).then(e=>this.signInWithFacebookSdk(e)).then(e=>this.fetchUserDetails(e))}loadDependencies(){return this.appendFacebookScript().then(()=>this.initFacebookSdk())}appendFacebookScript(){return window.FB?Promise.resolve():new Promise((n,t)=>{const i=window.document.createElement("script");i.async=!0,i.src=e.apiUrl,i.onload=()=>n(),i.onerror=e=>t(e),window.document.head.appendChild(i)})}initFacebookSdk(){return window.FB?(FB.init({appId:this.appId,version:"v6.0",frictionlessRequests:!0}),new Promise(e=>FB.getLoginStatus(n=>e(n)))):Promise.reject("Couldn't find window.FB")}signInWithFacebookSdk(e){return"connected"===e.status?Promise.resolve(e):new Promise(e=>FB.login(n=>e(n),{scope:"email"}))}fetchUserDetails(e){if("connected"!==e.status)return Promise.reject({message:"Facebook sign in failed and may have been cancelled by the user.",status:e.status});const n=e.authResponse;return new Promise((e,t)=>{FB.api("/me",{fields:"name, email, picture.width(1440).height(1440)"},t=>{e(this.getSignInResultFromUserDetails(t,n))})})}getSignInResultFromUserDetails(e,n){var t,i;if(!(null==e?void 0:e.email))throw new Error("Facebook sign-in succeeded, but the resulting user details didn't contain an email. User details: "+JSON.stringify(e));const s=n.expiresIn,o=new Date;return o.setSeconds(s||1e4),{email:e.email,name:e.name,imageUrl:null===(i=null===(t=e.picture)||void 0===t?void 0:t.data)||void 0===i?void 0:i.url,error:null,accessToken:null==n?void 0:n.accessToken,accessTokenExpiration:o,provider:"Facebook",providerData:{user:e,auth:n}}}}e.apiUrl="https://connect.facebook.net/en_US/sdk.js";export{e as FacebookProvider};
