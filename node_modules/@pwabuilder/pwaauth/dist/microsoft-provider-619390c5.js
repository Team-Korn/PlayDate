/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};function t(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function c(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))}function o(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var i,a,c,s,u=function(){function e(){}return e.createNewGuid=function(){var t=window.crypto;if(t&&t.getRandomValues){var r=new Uint8Array(16);return t.getRandomValues(r),r[6]|=64,r[6]&=79,r[8]|=128,r[8]&=191,e.decimalToHex(r[0])+e.decimalToHex(r[1])+e.decimalToHex(r[2])+e.decimalToHex(r[3])+"-"+e.decimalToHex(r[4])+e.decimalToHex(r[5])+"-"+e.decimalToHex(r[6])+e.decimalToHex(r[7])+"-"+e.decimalToHex(r[8])+e.decimalToHex(r[9])+"-"+e.decimalToHex(r[10])+e.decimalToHex(r[11])+e.decimalToHex(r[12])+e.decimalToHex(r[13])+e.decimalToHex(r[14])+e.decimalToHex(r[15])}for(var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",o="0123456789abcdef",i=0,a="",c=0;c<36;c++)"-"!==n[c]&&"4"!==n[c]&&(i=16*Math.random()|0),"x"===n[c]?a+=o[i]:"y"===n[c]?(i&=3,a+=o[i|=8]):a+=n[c];return a},e.isGuid=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},e.base64Encode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})))},e.base64Decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Invalid base64 string")}return decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))},e.deserialize=function(e){var t,r=/\+/g,n=/([^&=]+)=([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(r," "))},i={};for(t=n.exec(e);t;)i[o(t[1])]=o(t[2]),t=n.exec(e);return i},e}(),l=function(){function e(){}return Object.defineProperty(e,"claims",{get:function(){return"claims"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"clientId",{get:function(){return"clientId"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"adalIdToken",{get:function(){return"adal.idtoken"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cachePrefix",{get:function(){return"msal"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scopes",{get:function(){return"scopes"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"no_account",{get:function(){return"NO_ACCOUNT"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"consumersUtid",{get:function(){return"9188040d-6c67-4c5b-b112-36a304b66dad"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"upn",{get:function(){return"upn"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"prompt_select_account",{get:function(){return"&prompt=select_account"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"prompt_none",{get:function(){return"&prompt=none"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"prompt",{get:function(){return"prompt"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"response_mode_fragment",{get:function(){return"&response_mode=fragment"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"resourceDelimiter",{get:function(){return"|"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cacheDelimiter",{get:function(){return"."},enumerable:!0,configurable:!0}),Object.defineProperty(e,"popUpWidth",{get:function(){return this._popUpWidth},set:function(e){this._popUpWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"popUpHeight",{get:function(){return this._popUpHeight},set:function(e){this._popUpHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"login",{get:function(){return"LOGIN"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"renewToken",{get:function(){return"RENEW_TOKEN"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"unknown",{get:function(){return"UNKNOWN"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"homeAccountIdentifier",{get:function(){return"homeAccountIdentifier"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"common",{get:function(){return"common"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"openidScope",{get:function(){return"openid"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"profileScope",{get:function(){return"profile"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"interactionTypeRedirect",{get:function(){return"redirectInteraction"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"interactionTypePopup",{get:function(){return"popupInteraction"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"inProgress",{get:function(){return"inProgress"},enumerable:!0,configurable:!0}),e._popUpWidth=483,e._popUpHeight=600,e}();!function(e){e.SCOPE="scope",e.ERROR="error",e.ERROR_DESCRIPTION="error_description",e.ACCESS_TOKEN="access_token",e.ID_TOKEN="id_token",e.EXPIRES_IN="expires_in",e.SESSION_STATE="session_state",e.CLIENT_INFO="client_info"}(i||(i={})),function(e){e.AUTHORITY="authority",e.ACQUIRE_TOKEN_ACCOUNT="acquireTokenAccount",e.SESSION_STATE="session.state",e.STATE_LOGIN="state.login",e.STATE_ACQ_TOKEN="state.acquireToken",e.STATE_RENEW="state.renew",e.NONCE_IDTOKEN="nonce.idtoken",e.LOGIN_REQUEST="login.request",e.RENEW_STATUS="token.renew.status",e.URL_HASH="urlHash",e.ANGULAR_LOGIN_REQUEST="angular.login.request",e.INTERACTION_STATUS="interaction_status",e.REDIRECT_REQUEST="redirect_request"}(a||(a={})),function(e){e.IDTOKEN="idtoken",e.CLIENT_INFO="client.info"}(c||(c={})),function(e){e.LOGIN_ERROR="login.error",e.ERROR="error",e.ERROR_DESC="error.description"}(s||(s={}));var h,d={"login.windows.net":"login.windows.net","login.chinacloudapi.cn":"login.chinacloudapi.cn","login.cloudgovapi.us":"login.cloudgovapi.us","login.microsoftonline.com":"login.microsoftonline.com","login.microsoftonline.de":"login.microsoftonline.de","login.microsoftonline.us":"login.microsoftonline.us"};!function(e){e.ACCOUNT="account",e.SID="sid",e.LOGIN_HINT="login_hint",e.ID_TOKEN="id_token",e.DOMAIN_HINT="domain_hint",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers",e.ACCOUNT_ID="accountIdentifier",e.HOMEACCOUNT_ID="homeAccountIdentifier",e.LOGIN_REQ="login_req",e.DOMAIN_REQ="domain_req"}(h||(h={}));var p=[h.SID,h.LOGIN_HINT],f={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none"};var g,m={code:"unexpected_error",desc:"Unexpected error in authentication."},I={code:"no_window_object",desc:"No window object available. Details:"},y=function(e){function r(t,n){var o=e.call(this,n)||this;return Object.setPrototypeOf(o,r.prototype),o.errorCode=t,o.errorMessage=n,o.name="AuthError",o}return t(r,e),r.createUnexpectedError=function(e){return new r(m.code,m.desc+": "+e)},r.createNoWindowObjectError=function(e){return new r(I.code,I.desc+" "+e)},r}(Error),v=function(){function e(){}return e.isEmpty=function(e){return void 0===e||!e||0===e.length},e}(),w={code:"multiple_matching_tokens",desc:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements like authority."},E={code:"multiple_authorities",desc:"Multiple authorities found in the cache. Pass authority in the API overload."},T={code:"endpoints_resolution_error",desc:"Error: could not resolve endpoints. Please check network and try again."},S={code:"popup_window_error",desc:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser."},C={code:"token_renewal_error",desc:"Token renewal operation failed due to timeout."},k={code:"invalid_id_token",desc:"Invalid ID token format."},b={code:"invalid_state_error",desc:"Invalid state."},O={code:"nonce_mismatch_error",desc:"Nonce is not matching, Nonce received: "},R={code:"login_progress_error",desc:"Login_In_Progress: Error during login call - login is already in progress."},A={code:"acquiretoken_progress_error",desc:"AcquireToken_In_Progress: Error during login call - login is already in progress."},_={code:"user_cancelled",desc:"User cancelled the flow."},N={code:"callback_error",desc:"Error occurred in token received callback function."},P={code:"user_login_error",desc:"User login is required."},U={code:"user_non_existent",desc:"User object does not exist. Please call a login API."},x={code:"client_info_decoding_error",desc:"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."},D={code:"client_info_not_populated_error",desc:"The service did not populate client_info in the response, Please verify with the service team"},L={code:"null_or_empty_id_token",desc:"The idToken is null or empty. Please review the trace to determine the root cause."},H={code:"id_token_parsing_error",desc:"ID token cannot be parsed. Please review stack trace to determine root cause."},q={code:"token_encoding_error",desc:"The token to be decoded is not encoded correctly."},M={code:"invalid_interaction_type",desc:"The interaction type passed to the handler was incorrect or unknown"},j={code:"cannot_parse_cache",desc:"The cached token key is not a valid JSON and cannot be parsed"},G={code:"block_token_requests",desc:"Token calls are blocked in hidden iframes"},F=function(e){function r(t,n){var o=e.call(this,t,n)||this;return o.name="ClientAuthError",Object.setPrototypeOf(o,r.prototype),o}return t(r,e),r.createEndpointResolutionError=function(e){var t=T.desc;return e&&!v.isEmpty(e)&&(t+=" Details: "+e),new r(T.code,t)},r.createMultipleMatchingTokensInCacheError=function(e){return new r(w.code,"Cache error for scope "+e+": "+w.desc+".")},r.createMultipleAuthoritiesInCacheError=function(e){return new r(E.code,"Cache error for scope "+e+": "+E.desc+".")},r.createPopupWindowError=function(e){var t=S.desc;return e&&!v.isEmpty(e)&&(t+=" Details: "+e),new r(S.code,t)},r.createTokenRenewalTimeoutError=function(e){var t="URL navigated to is "+e+", "+C.desc;return new r(C.code,t)},r.createInvalidIdTokenError=function(e){return new r(k.code,k.desc+" Given token: "+e)},r.createInvalidStateError=function(e,t){return new r(b.code,b.desc+" "+e+", state expected : "+t+".")},r.createNonceMismatchError=function(e,t){return new r(O.code,O.desc+" "+e+", nonce expected : "+t+".")},r.createLoginInProgressError=function(){return new r(R.code,R.desc)},r.createAcquireTokenInProgressError=function(){return new r(A.code,A.desc)},r.createUserCancelledError=function(){return new r(_.code,_.desc)},r.createErrorInCallbackFunction=function(e){return new r(N.code,N.desc+" "+e+".")},r.createUserLoginRequiredError=function(){return new r(P.code,P.desc)},r.createUserDoesNotExistError=function(){return new r(U.code,U.desc)},r.createClientInfoDecodingError=function(e){return new r(x.code,x.desc+" Failed with error: "+e)},r.createClientInfoNotPopulatedError=function(e){return new r(D.code,D.desc+" Failed with error: "+e)},r.createIdTokenNullOrEmptyError=function(e){return new r(L.code,L.desc+" Raw ID Token Value: "+e)},r.createIdTokenParsingError=function(e){return new r(H.code,H.desc+" Failed with error: "+e)},r.createTokenEncodingError=function(e){return new r(q.code,q.desc+" Attempted to decode: "+e)},r.createInvalidInteractionTypeError=function(){return new r(M.code,M.desc)},r.createCacheParseError=function(e){var t="invalid key: "+e+", "+j.desc;return new r(j.code,t)},r.createBlockTokenRequestsInHiddenIframeError=function(){return new r(G.code,G.desc)},r}(y),K={code:"no_config_set",desc:"Configuration has not been set. Please call the UserAgentApplication constructor with a valid Configuration object."},W={code:"storage_not_supported",desc:"The value for the cacheLocation is not supported."},Q={code:"no_redirect_callbacks",desc:"No redirect callbacks have been set. Please call handleRedirectCallback() with the appropriate function arguments before continuing. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},V={code:"invalid_callback_object",desc:"The object passed for the callback was invalid. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},B={code:"scopes_required",desc:"Scopes are required to obtain an access token."},J={code:"empty_input_scopes_error",desc:"Scopes cannot be passed as empty array."},z={code:"nonarray_input_scopes_error",desc:"Scopes cannot be passed as non-array."},Z={code:"clientid_input_scopes_error",desc:"Client ID can only be provided as a single scope."},$={code:"invalid_prompt_value",desc:"Supported prompt values are 'login', 'select_account', 'consent' and 'none'"},X={code:"invalid_authority_type",desc:"The given authority is not a valid type of authority supported by MSAL. Please see here for valid authorities: <insert URL here>."},Y={code:"authority_uri_insecure",desc:"Authority URIs must use https."},ee={code:"authority_uri_invalid_path",desc:"Given authority URI is invalid."},te={code:"unsupported_authority_validation",desc:"The authority validation is not supported for this authority type."},re={code:"b2c_authority_uri_invalid_path",desc:"The given URI for the B2C authority is invalid."},ne={code:"claims_request_parsing_error",desc:"Could not parse the given claims request object."},oe={code:"empty_request_error",desc:"Request object is required."},ie={code:"invalid_guid_sent_as_correlationId",desc:"Please set the correlationId as a valid guid"},ae={code:"telemetry_config_error",desc:"Telemetry config is not configured with required values"},ce=function(e){function r(t,n){var o=e.call(this,t,n)||this;return o.name="ClientConfigurationError",Object.setPrototypeOf(o,r.prototype),o}return t(r,e),r.createNoSetConfigurationError=function(){return new r(K.code,""+K.desc)},r.createStorageNotSupportedError=function(e){return new r(W.code,W.desc+" Given location: "+e)},r.createRedirectCallbacksNotSetError=function(){return new r(Q.code,Q.desc)},r.createInvalidCallbackObjectError=function(e){return new r(V.code,V.desc+" Given value for callback function: "+e)},r.createEmptyScopesArrayError=function(e){return new r(J.code,J.desc+" Given value: "+e+".")},r.createScopesNonArrayError=function(e){return new r(z.code,z.desc+" Given value: "+e+".")},r.createClientIdSingleScopeError=function(e){return new r(Z.code,Z.desc+" Given value: "+e+".")},r.createScopesRequiredError=function(e){return new r(B.code,B.desc+" Given value: "+e)},r.createInvalidPromptError=function(e){return new r($.code,$.desc+" Given value: "+e)},r.createClaimsRequestParsingError=function(e){return new r(ne.code,ne.desc+" Given value: "+e)},r.createEmptyRequestError=function(){var e=oe;return new r(e.code,e.desc)},r.createInvalidCorrelationIdError=function(){return new r(ie.code,ie.desc)},r.createTelemetryConfigError=function(e){var t=ae,n=t.code,o=t.desc,i={applicationName:"string",applicationVersion:"string",telemetryEmitter:"function"};return new r(n,o+" mising values: "+Object.keys(i).reduce((function(t,r){return e[r]?t:t.concat([r+" ("+i[r]+")"])}),[]).join(","))},r}(F),se=function(){function e(){}return e.isIntersectingScopes=function(e,t){e=this.convertToLowerCase(e);for(var r=0;r<t.length;r++)if(e.indexOf(t[r].toLowerCase())>-1)return!0;return!1},e.containsScope=function(e,t){return e=this.convertToLowerCase(e),t.every((function(t){return e.indexOf(t.toString().toLowerCase())>=0}))},e.convertToLowerCase=function(e){return e.map((function(e){return e.toLowerCase()}))},e.removeElement=function(e,t){return e.filter((function(e){return e!==t}))},e.parseScope=function(e){var t="";if(e)for(var r=0;r<e.length;++r)t+=r!==e.length-1?e[r]+" ":e[r];return t},e.validateInputScope=function(e,t,r){if(e){if(!Array.isArray(e))throw ce.createScopesNonArrayError(e);if(e.length<1)throw ce.createEmptyScopesArrayError(e.toString());if(e.indexOf(r)>-1&&e.length>1)throw ce.createClientIdSingleScopeError(e.toString())}else if(t)throw ce.createScopesRequiredError(e)},e.getScopeFromState=function(e){if(e){var t=e.indexOf("|");if(t>-1&&t+1<e.length)return e.substring(t+1)}return""},e.appendScopes=function(e,t){return e?t?e.concat(t):e:null},e}(),ue=function(){function e(){}return e.createNavigateUrl=function(e){var t=this.createNavigationUrlString(e),r=e.authorityInstance.AuthorizationEndpoint;return r.indexOf("?")<0?r+="?":r+="&",""+r+t.join("&")},e.createNavigationUrlString=function(e){var t=e.scopes;-1===t.indexOf(e.clientId)&&t.push(e.clientId);var r=[];return r.push("response_type="+e.responseType),this.translateclientIdUsedInScope(t,e.clientId),r.push("scope="+encodeURIComponent(se.parseScope(t))),r.push("client_id="+encodeURIComponent(e.clientId)),r.push("redirect_uri="+encodeURIComponent(e.redirectUri)),r.push("state="+encodeURIComponent(e.state)),r.push("nonce="+encodeURIComponent(e.nonce)),r.push("client_info=1"),r.push("x-client-SKU="+e.xClientSku),r.push("x-client-Ver="+e.xClientVer),e.promptValue&&r.push("prompt="+encodeURIComponent(e.promptValue)),e.claimsValue&&r.push("claims="+encodeURIComponent(e.claimsValue)),e.queryParameters&&r.push(e.queryParameters),e.extraQueryParameters&&r.push(e.extraQueryParameters),r.push("client-request-id="+encodeURIComponent(e.correlationId)),r},e.translateclientIdUsedInScope=function(e,t){var r=e.indexOf(t);r>=0&&(e.splice(r,1),-1===e.indexOf("openid")&&e.push("openid"),-1===e.indexOf("profile")&&e.push("profile"))},e.getDefaultRedirectUri=function(){return window.location.href.split("?")[0].split("#")[0]},e.replaceTenantPath=function(e,t){e=e.toLowerCase();var r=this.GetUrlComponents(e),n=r.PathSegments;return!t||0===n.length||n[0]!==l.common&&n[0]!==h.ORGANIZATIONS||(n[0]=t),this.constructAuthorityUriFromObject(r,n)},e.constructAuthorityUriFromObject=function(e,t){return this.CanonicalizeUri(e.Protocol+"//"+e.HostNameAndPort+"/"+t.join("/"))},e.GetUrlComponents=function(e){if(!e)throw"Url required";var t=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),r=e.match(t);if(!r||r.length<6)throw"Valid url required";var n={Protocol:r[1],HostNameAndPort:r[4],AbsolutePath:r[5]},o=n.AbsolutePath.split("/");return o=o.filter((function(e){return e&&e.length>0})),n.PathSegments=o,n},e.CanonicalizeUri=function(t){return t&&(t=t.toLowerCase()),t&&!e.endsWith(t,"/")&&(t+="/"),t},e.endsWith=function(e,t){return!(!e||!t)&&-1!==e.indexOf(t,e.length-t.length)},e.urlRemoveQueryStringParameter=function(e,t){if(v.isEmpty(e))return e;var r=new RegExp("(\\&"+t+"=)[^&]+");return e=e.replace(r,""),r=new RegExp("("+t+"=)[^&]+&"),e=e.replace(r,""),r=new RegExp("("+t+"=)[^&]+"),e=e.replace(r,"")},e.getHashFromUrl=function(e){var t=e.indexOf("#"),r=e.indexOf("#/");return r>-1?e.substring(r+2):t>-1?e.substring(t+1):e},e.urlContainsHash=function(t){var r=e.deserializeHash(t);return r.hasOwnProperty(i.ERROR_DESCRIPTION)||r.hasOwnProperty(i.ERROR)||r.hasOwnProperty(i.ACCESS_TOKEN)||r.hasOwnProperty(i.ID_TOKEN)},e.deserializeHash=function(t){var r=e.getHashFromUrl(t);return u.deserialize(r)},e.getHostFromUri=function(e){var t=String(e).replace(/^(https?:)\/\//,"");return t=t.split("/")[0]},e}(),le=function(e,t,r,n,o){this.authority=ue.CanonicalizeUri(e),this.clientId=t,this.scopes=r,this.homeAccountIdentifier=u.base64Encode(n)+"."+u.base64Encode(o)},he=function(e,t,r,n){this.accessToken=e,this.idToken=t,this.expiresIn=r,this.homeAccountIdentifier=n},de=function(){function e(e,t,r,n,o,i,a){this.authorityInstance=e,this.clientId=t,this.nonce=u.createNewGuid(),this.scopes=o?o.slice():[t],this.state=i,this.correlationId=a,this.xClientSku="MSAL.JS",this.xClientVer="1.2.1",this.responseType=r,this.redirectUri=n}return Object.defineProperty(e.prototype,"authority",{get:function(){return this.authorityInstance?this.authorityInstance.CanonicalAuthority:null},enumerable:!0,configurable:!0}),e.prototype.populateQueryParams=function(t,r,n){var o={};r&&(r.prompt&&(this.promptValue=r.prompt),r.claimsRequest&&(this.claimsValue=r.claimsRequest),e.isSSOParam(r)&&(o=this.constructUnifiedCacheQueryParameter(r,null))),n&&(o=this.constructUnifiedCacheQueryParameter(null,n)),o=this.addHintParameters(t,o);var i=r.extraQueryParameters;this.queryParameters=e.generateQueryParametersString(o),this.extraQueryParameters=e.generateQueryParametersString(i)},e.prototype.constructUnifiedCacheQueryParameter=function(e,t){var r,n,o={};if(e)if(e.account){var i=e.account;i.sid?(r=h.SID,n=i.sid):i.userName&&(r=h.LOGIN_HINT,n=i.userName)}else e.sid?(r=h.SID,n=e.sid):e.loginHint&&(r=h.LOGIN_HINT,n=e.loginHint);else t&&(t.hasOwnProperty(l.upn)?(r=h.ID_TOKEN,n=t.upn):(r=h.ORGANIZATIONS,n=null));return o=this.addSSOParameter(r,n),e&&e.account&&e.account.homeAccountIdentifier&&(o=this.addSSOParameter(h.HOMEACCOUNT_ID,e.account.homeAccountIdentifier,o)),o},e.prototype.addHintParameters=function(e,t){if(e&&!t[h.SID]){if(!t[h.LOGIN_HINT]&&e.sid&&this.promptValue===f.NONE)t=this.addSSOParameter(h.SID,e.sid,t);else!t[h.LOGIN_HINT]&&e.userName&&!v.isEmpty(e.userName)&&(t=this.addSSOParameter(h.LOGIN_HINT,e.userName,t));!t[h.DOMAIN_REQ]&&!t[h.LOGIN_REQ]&&(t=this.addSSOParameter(h.HOMEACCOUNT_ID,e.homeAccountIdentifier,t))}return t},e.prototype.addSSOParameter=function(e,t,r){if(r||(r={}),!t)return r;switch(e){case h.SID:r[h.SID]=t;break;case h.ID_TOKEN:r[h.LOGIN_HINT]=t,r[h.DOMAIN_HINT]=h.ORGANIZATIONS;break;case h.LOGIN_HINT:r[h.LOGIN_HINT]=t;break;case h.ORGANIZATIONS:r[h.DOMAIN_HINT]=h.ORGANIZATIONS;break;case h.CONSUMERS:r[h.DOMAIN_HINT]=h.CONSUMERS;break;case h.HOMEACCOUNT_ID:var n=t.split("."),o=u.base64Decode(n[0]),i=u.base64Decode(n[1]);r[h.LOGIN_REQ]=o,r[h.DOMAIN_REQ]=i,i===l.consumersUtid?r[h.DOMAIN_HINT]=h.CONSUMERS:r[h.DOMAIN_HINT]=h.ORGANIZATIONS;break;case h.LOGIN_REQ:r[h.LOGIN_REQ]=t;break;case h.DOMAIN_REQ:r[h.DOMAIN_REQ]=t}return r},e.generateQueryParametersString=function(e){var t=null;return e&&Object.keys(e).forEach((function(r){null==t?t=r+"="+encodeURIComponent(e[r]):t+="&"+r+"="+encodeURIComponent(e[r])})),t},e.isSSOParam=function(e){return e&&(e.account||e.sid||e.loginHint)},e}(),pe=function(){function e(e){if(!e||v.isEmpty(e))return this.uid="",void(this.utid="");try{var t=u.base64Decode(e),r=JSON.parse(t);r&&(r.hasOwnProperty("uid")&&(this.uid=r.uid),r.hasOwnProperty("utid")&&(this.utid=r.utid))}catch(e){throw F.createClientInfoDecodingError(e)}}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid?this._uid:""},set:function(e){this._uid=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"utid",{get:function(){return this._utid?this._utid:""},set:function(e){this._utid=e},enumerable:!0,configurable:!0}),e}(),fe=function(){function e(){}return e.decodeJwt=function(e){if(v.isEmpty(e))return null;var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);return!t||t.length<4?null:{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},e.extractIdToken=function(e){var t=this.decodeJwt(e);if(!t)return null;try{var r=t.JWSPayload,n=u.base64Decode(r);return n?JSON.parse(n):null}catch(e){}return null},e}(),ge=function(e){if(v.isEmpty(e))throw F.createIdTokenNullOrEmptyError(e);try{this.rawIdToken=e,this.claims=fe.extractIdToken(e),this.claims&&(this.claims.hasOwnProperty("iss")&&(this.issuer=this.claims.iss),this.claims.hasOwnProperty("oid")&&(this.objectId=this.claims.oid),this.claims.hasOwnProperty("sub")&&(this.subject=this.claims.sub),this.claims.hasOwnProperty("tid")&&(this.tenantId=this.claims.tid),this.claims.hasOwnProperty("ver")&&(this.version=this.claims.ver),this.claims.hasOwnProperty("preferred_username")&&(this.preferredName=this.claims.preferred_username),this.claims.hasOwnProperty("name")&&(this.name=this.claims.name),this.claims.hasOwnProperty("nonce")&&(this.nonce=this.claims.nonce),this.claims.hasOwnProperty("exp")&&(this.expiration=this.claims.exp),this.claims.hasOwnProperty("home_oid")&&(this.homeObjectId=this.claims.home_oid),this.claims.hasOwnProperty("sid")&&(this.sid=this.claims.sid),this.claims.hasOwnProperty("cloud_instance_host_name")&&(this.cloudInstance=this.claims.cloud_instance_host_name))}catch(e){throw F.createIdTokenParsingError(e)}},me=function(e,t){this.key=e,this.value=t},Ie=function(e){function r(t,r,n){var o=e.call(this,r)||this;return o.clientId=t,o.rollbackEnabled=!0,o.migrateCacheEntries(n),o}return t(r,e),r.prototype.migrateCacheEntries=function(t){var r=this,n=l.cachePrefix+"."+c.IDTOKEN,o=l.cachePrefix+"."+c.CLIENT_INFO,i=l.cachePrefix+"."+s.ERROR,a=l.cachePrefix+"."+s.ERROR_DESC,u=[e.prototype.getItem.call(this,n),e.prototype.getItem.call(this,o),e.prototype.getItem.call(this,i),e.prototype.getItem.call(this,a)];[c.IDTOKEN,c.CLIENT_INFO,s.ERROR,s.ERROR_DESC].forEach((function(e,n){return r.duplicateCacheEntry(e,u[n],t)}))},r.prototype.duplicateCacheEntry=function(e,t,r){t&&this.setItem(e,t,r)},r.prototype.generateCacheKey=function(e,t){try{return JSON.parse(e),e}catch(r){return 0===e.indexOf(""+l.cachePrefix)||0===e.indexOf(l.adalIdToken)?e:t?l.cachePrefix+"."+this.clientId+"."+e:l.cachePrefix+"."+e}},r.prototype.setItem=function(t,r,n,o){e.prototype.setItem.call(this,this.generateCacheKey(t,!0),r,n),this.rollbackEnabled&&e.prototype.setItem.call(this,this.generateCacheKey(t,!1),r,n)},r.prototype.getItem=function(t,r){return e.prototype.getItem.call(this,this.generateCacheKey(t,!0),r)},r.prototype.removeItem=function(t){e.prototype.removeItem.call(this,this.generateCacheKey(t,!0)),this.rollbackEnabled&&e.prototype.removeItem.call(this,this.generateCacheKey(t,!1))},r.prototype.resetCacheItems=function(){var t,r=window[this.cacheLocation];for(t in r)r.hasOwnProperty(t)&&-1!==t.indexOf(l.cachePrefix)&&e.prototype.removeItem.call(this,t)},r.prototype.resetTempCacheItems=function(e){var t,r=window[this.cacheLocation];for(t in r)if(!e||-1!==t.indexOf(e)){var n=t.split(l.resourceDelimiter),o=n.length>1?n[n.length-1]:null;o!==e||this.tokenRenewalInProgress(o)||(this.removeItem(t),this.setItemCookie(t,"",-1),this.clearMsalCookie(e))}this.removeItem(a.INTERACTION_STATUS),this.removeItem(a.REDIRECT_REQUEST)},r.prototype.setItemCookie=function(t,r,n){e.prototype.setItemCookie.call(this,this.generateCacheKey(t,!0),r,n),this.rollbackEnabled&&e.prototype.setItemCookie.call(this,this.generateCacheKey(t,!1),r,n)},r.prototype.getItemCookie=function(t){return e.prototype.getItemCookie.call(this,this.generateCacheKey(t,!0))},r.prototype.getAllAccessTokens=function(e,t){var r=this;return Object.keys(window[this.cacheLocation]).reduce((function(n,o){if(o.match(e)&&o.match(t)&&o.match(l.scopes)){var i=r.getItem(o);if(i)try{var a=JSON.parse(o),c=new me(a,JSON.parse(i));return n.concat([c])}catch(e){throw F.createCacheParseError(o)}}return n}),[])},r.prototype.tokenRenewalInProgress=function(e){var t=this.getItem(a.RENEW_STATUS+"|"+e);return!(!t||t!==l.inProgress)},r.prototype.clearMsalCookie=function(e){this.clearItemCookie(a.NONCE_IDTOKEN+"|"+e),this.clearItemCookie(a.STATE_LOGIN+"|"+e),this.clearItemCookie(a.LOGIN_REQUEST+"|"+e),this.clearItemCookie(a.STATE_ACQ_TOKEN+"|"+e)},r.generateAcquireTokenAccountKey=function(e,t){return""+a.ACQUIRE_TOKEN_ACCOUNT+l.resourceDelimiter+e+l.resourceDelimiter+t},r.generateAuthorityKey=function(e){return""+a.AUTHORITY+l.resourceDelimiter+e},r}(function(){function e(e){if(!window)throw y.createNoWindowObjectError("Browser storage class could not find window object");if(!(void 0!==window[e]&&null!=window[e]))throw ce.createStorageNotSupportedError(e);this.cacheLocation=e}return e.prototype.setItem=function(e,t,r){window[this.cacheLocation].setItem(e,t),r&&this.setItemCookie(e,t)},e.prototype.getItem=function(e,t){return t&&this.getItemCookie(e)?this.getItemCookie(e):window[this.cacheLocation].getItem(e)},e.prototype.removeItem=function(e){return window[this.cacheLocation].removeItem(e)},e.prototype.clear=function(){return window[this.cacheLocation].clear()},e.prototype.setItemCookie=function(e,t,r){var n=e+"="+t+";path=/;";r&&(n+="expires="+this.getCookieExpirationTime(r)+";");document.cookie=n},e.prototype.getItemCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return""},e.prototype.clearItemCookie=function(e){this.setItemCookie(e,"",-1)},e.prototype.getCookieExpirationTime=function(e){var t=new Date;return new Date(t.getTime()+24*e*60*60*1e3).toUTCString()},e}()),ye=function(){function e(e,t,r,n,o,i,a){this.accountIdentifier=e,this.homeAccountIdentifier=t,this.userName=r,this.name=n,this.idToken=o,this.idTokenClaims=o,this.sid=i,this.environment=a}return e.createAccount=function(t,r){var n,o=t.objectId||t.subject,i=r?r.uid:"",a=r?r.utid:"";return v.isEmpty(i)||v.isEmpty(a)||(n=u.base64Encode(i)+"."+u.base64Encode(a)),new e(o,n,t.preferredName,t.name,t.claims,t.sid,t.issuer)},e.compareAccounts=function(e,t){return!(!e||!t)&&!(!e.homeAccountIdentifier||!t.homeAccountIdentifier||e.homeAccountIdentifier!==t.homeAccountIdentifier)},e}(),ve=function(){function e(){}return e.isInIframe=function(){return window.parent!==window},e.isInPopup=function(){return!(!window.opener||window.opener===window)},e.monitorWindowForHash=function(t,r,n){return new Promise((function(o,i){var a=r/e.POLLING_INTERVAL_MS,c=0,s=setInterval((function(){if(t.closed)return clearInterval(s),void i(F.createUserCancelledError());var e;try{e=t.location.href}catch(e){}e&&"about:blank"!==e&&(c++,ue.urlContainsHash(e)?(clearInterval(s),o(t.location.hash)):c>a&&(clearInterval(s),i(F.createTokenRenewalTimeoutError(n))))}),e.POLLING_INTERVAL_MS)}))},e.loadFrame=function(t,r,n,o){return o.info("LoadFrame: "+r),new Promise((function(i,a){setTimeout((function(){var n=e.addHiddenIFrame(r,o);n?(""!==n.src&&"about:blank"!==n.src||(n.src=t,o.infoPii("Frame Name : "+r+" Navigated to: "+t)),i(n)):a("Unable to load iframe with name: "+r)}),n)}))},e.addHiddenIFrame=function(e,t){if(void 0===e)return null;t.info("Add msal frame to document:"+e);var r=document.getElementById(e);if(!r){if(document.createElement&&document.documentElement&&-1===window.navigator.userAgent.indexOf("MSIE 5.0")){var n=document.createElement("iframe");n.setAttribute("id",e),n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),r=document.getElementsByTagName("body")[0].appendChild(n)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeend","<iframe name='"+e+"' id='"+e+"' style='display:none'></iframe>");window.frames&&window.frames[e]&&(r=window.frames[e])}return r},e.removeHiddenIframe=function(e){document.body!==e.parentNode&&document.body.removeChild(e)},e.getIframeWithHash=function(e){var t=document.getElementsByTagName("iframe");return Array.apply(null,Array(t.length)).map((function(e,r){return t.item(r)})).filter((function(t){try{return t.contentWindow.location.hash===e}catch(e){return!1}}))[0]},e.getPopups=function(){return window.openedWindows||(window.openedWindows=[]),window.openedWindows},e.getPopUpWithHash=function(t){return e.getPopups().filter((function(e){try{return e.location.hash===t}catch(e){return!1}}))[0]},e.trackPopup=function(t){e.getPopups().push(t)},e.closePopups=function(){e.getPopups().forEach((function(e){return e.close()}))},e.blockReloadInHiddenIframes=function(){if(ue.urlContainsHash(window.location.hash)&&e.isInIframe())throw F.createBlockTokenRequestsInHiddenIframeError()},e.checkIfBackButtonIsPressed=function(e){var t=e.getItem(a.REDIRECT_REQUEST);if(t&&!ue.urlContainsHash(window.location.hash)){var r=t.split(l.resourceDelimiter),n=r.length>1?r[r.length-1]:null;e.resetTempCacheItems(n)}},e.POLLING_INTERVAL_MS=50,e}(),we=function(){function e(){}return e.parseExpiresIn=function(e){return e||(e="3599"),parseInt(e,10)},e.now=function(){return Math.round((new Date).getTime()/1e3)},e}(),Ee=function(){function e(){}return e.validateRequest=function(e,t,n,o,i){if(!t&&!e)throw ce.createEmptyRequestError();if(o==l.interactionTypeRedirect&&!i)throw ce.createRedirectCallbacksNotSetError();var a,c;e&&(a=t?se.appendScopes(e.scopes,e.extraScopesToConsent):e.scopes,se.validateInputScope(a,!t,n),this.validatePromptParameter(e.prompt),c=this.validateEQParameters(e.extraQueryParameters,e.claimsRequest),this.validateClaimsRequest(e.claimsRequest));var s=this.validateAndGenerateState(e&&e.state),u=this.validateAndGenerateCorrelationId(e&&e.correlationId);return r({},e,{extraQueryParameters:c,scopes:a,state:s,correlationId:u})},e.validatePromptParameter=function(e){if(e&&[f.LOGIN,f.SELECT_ACCOUNT,f.CONSENT,f.NONE].indexOf(e)<0)throw ce.createInvalidPromptError(e)},e.validateEQParameters=function(e,t){var n=r({},e);return n?(t&&delete n[l.claims],p.forEach((function(e){n[e]&&delete n[e]})),n):null},e.validateClaimsRequest=function(e){if(e)try{JSON.parse(e)}catch(e){throw ce.createClaimsRequestParsingError(e)}},e.validateAndGenerateState=function(e){return v.isEmpty(e)?u.createNewGuid():u.createNewGuid()+"|"+e},e.validateAndGenerateCorrelationId=function(e){if(e&&!u.isGuid(e))throw ce.createInvalidCorrelationIdError();return u.isGuid(e)?e:u.createNewGuid()},e}(),Te=function(){function e(){}return e.setResponseIdToken=function(e,t){if(!e)return null;if(!t)return e;var n=Number(t.expiration);return n&&!e.expiresOn&&(e.expiresOn=new Date(1e3*n)),r({},e,{idToken:t,idTokenClaims:t.claims,uniqueId:t.objectId||t.subject,tenantId:t.tenantId})},e}(),Se=function(){function e(){}return e.prototype.sendRequestAsync=function(e,t,r){var n=this;return new Promise((function(r,o){var i=new XMLHttpRequest;if(i.open(t,e,!0),i.onload=function(e){var t;(i.status<200||i.status>=300)&&o(n.handleError(i.responseText));try{t=JSON.parse(i.responseText)}catch(e){o(n.handleError(i.responseText))}r(t)},i.onerror=function(e){o(i.status)},"GET"!==t)throw"not implemented";i.send()}))},e.prototype.handleError=function(e){var t;try{if((t=JSON.parse(e)).error)return t.error;throw e}catch(t){return e}},e}();!function(e){e[e.Aad=0]="Aad",e[e.Adfs=1]="Adfs",e[e.B2C=2]="B2C"}(g||(g={}));var Ce,ke=function(e){function r(t,r){return e.call(this,t,r)||this}return t(r,e),Object.defineProperty(r.prototype,"AadInstanceDiscoveryEndpointUrl",{get:function(){return r.AadInstanceDiscoveryEndpoint+"?api-version=1.0&authorization_endpoint="+this.CanonicalAuthority+"oauth2/v2.0/authorize"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"AuthorityType",{get:function(){return g.Aad},enumerable:!0,configurable:!0}),r.prototype.GetOpenIdConfigurationEndpointAsync=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){return!this.IsValidationEnabled||this.IsInTrustedHostList(this.CanonicalAuthorityUrlComponents.HostNameAndPort)?[2,this.DefaultOpenIdConfigurationEndpoint]:[2,(new Se).sendRequestAsync(this.AadInstanceDiscoveryEndpointUrl,"GET",!0).then((function(e){return e.tenant_discovery_endpoint}))]}))}))},r.prototype.IsInTrustedHostList=function(e){return d[e.toLowerCase()]},r.AadInstanceDiscoveryEndpoint="https://login.microsoftonline.com/common/discovery/instance",r}(function(){function e(e,t){this.IsValidationEnabled=t,this.CanonicalAuthority=e,this.validateAsUri()}return Object.defineProperty(e.prototype,"Tenant",{get:function(){return this.CanonicalAuthorityUrlComponents.PathSegments[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AuthorizationEndpoint",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.AuthorizationEndpoint.replace("{tenant}",this.Tenant)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EndSessionEndpoint",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.EndSessionEndpoint.replace("{tenant}",this.Tenant)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SelfSignedJwtAudience",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.Issuer.replace("{tenant}",this.Tenant)},enumerable:!0,configurable:!0}),e.prototype.validateResolved=function(){if(!this.tenantDiscoveryResponse)throw"Please call ResolveEndpointsAsync first"},Object.defineProperty(e.prototype,"CanonicalAuthority",{get:function(){return this.canonicalAuthority},set:function(e){this.canonicalAuthority=ue.CanonicalizeUri(e),this.canonicalAuthorityUrlComponents=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CanonicalAuthorityUrlComponents",{get:function(){return this.canonicalAuthorityUrlComponents||(this.canonicalAuthorityUrlComponents=ue.GetUrlComponents(this.CanonicalAuthority)),this.canonicalAuthorityUrlComponents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"DefaultOpenIdConfigurationEndpoint",{get:function(){return this.CanonicalAuthority+"v2.0/.well-known/openid-configuration"},enumerable:!0,configurable:!0}),e.prototype.validateAsUri=function(){var e;try{e=this.CanonicalAuthorityUrlComponents}catch(e){throw X}if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw Y;if(!e.PathSegments||e.PathSegments.length<1)throw ee},e.prototype.DiscoverEndpoints=function(e){return(new Se).sendRequestAsync(e,"GET",!0).then((function(e){return{AuthorizationEndpoint:e.authorization_endpoint,EndSessionEndpoint:e.end_session_endpoint,Issuer:e.issuer}}))},e.prototype.resolveEndpointsAsync=function(){return n(this,void 0,void 0,(function(){var e,t;return o(this,(function(r){switch(r.label){case 0:return[4,this.GetOpenIdConfigurationEndpointAsync()];case 1:return e=r.sent(),t=this,[4,this.DiscoverEndpoints(e)];case 2:return t.tenantDiscoveryResponse=r.sent(),[2,this]}}))}))},e}()),be=function(e){function r(t,r){var n=e.call(this,t,r)||this,o=ue.GetUrlComponents(t),i=o.PathSegments;if(i.length<3)throw re;return n.CanonicalAuthority="https://"+o.HostNameAndPort+"/"+i[0]+"/"+i[1]+"/"+i[2]+"/",n}return t(r,e),Object.defineProperty(r.prototype,"AuthorityType",{get:function(){return g.B2C},enumerable:!0,configurable:!0}),r.prototype.GetOpenIdConfigurationEndpointAsync=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){if(!this.IsValidationEnabled||this.IsInTrustedHostList(this.CanonicalAuthorityUrlComponents.HostNameAndPort))return[2,this.DefaultOpenIdConfigurationEndpoint];throw te}))}))},r.B2C_PREFIX="tfp",r}(ke),Oe=function(){function e(){}return e.DetectAuthorityFromUrl=function(e){switch(e=ue.CanonicalizeUri(e),ue.GetUrlComponents(e).PathSegments[0]){case"tfp":return g.B2C;default:return g.Aad}},e.CreateInstance=function(t,r){if(v.isEmpty(t))return null;switch(e.DetectAuthorityFromUrl(t)){case g.B2C:return new be(t,r);case g.Aad:return new ke(t,r);default:throw X}},e}();!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose"}(Ce||(Ce={}));var Re=function(){function e(e,t){void 0===t&&(t={}),this.level=Ce.Info;var r=t.correlationId,n=void 0===r?"":r,o=t.level,i=void 0===o?Ce.Info:o,a=t.piiLoggingEnabled,c=void 0!==a&&a;this.localCallback=e,this.correlationId=n,this.level=i,this.piiLoggingEnabled=c}return e.prototype.logMessage=function(e,t,r){if(!(e>this.level||!this.piiLoggingEnabled&&r)){var n,o=(new Date).toUTCString();n=v.isEmpty(this.correlationId)?o+":1.2.1-"+Ce[e]+" "+t:o+":"+this.correlationId+"-1.2.1-"+Ce[e]+" "+t,this.executeCallback(e,n,r)}},e.prototype.executeCallback=function(e,t,r){this.localCallback&&this.localCallback(e,t,r)},e.prototype.error=function(e){this.logMessage(Ce.Error,e,!1)},e.prototype.errorPii=function(e){this.logMessage(Ce.Error,e,!0)},e.prototype.warning=function(e){this.logMessage(Ce.Warning,e,!1)},e.prototype.warningPii=function(e){this.logMessage(Ce.Warning,e,!0)},e.prototype.info=function(e){this.logMessage(Ce.Info,e,!1)},e.prototype.infoPii=function(e){this.logMessage(Ce.Info,e,!0)},e.prototype.verbose=function(e){this.logMessage(Ce.Verbose,e,!1)},e.prototype.verbosePii=function(e){this.logMessage(Ce.Verbose,e,!0)},e.prototype.isPiiLoggingEnabled=function(){return this.piiLoggingEnabled},e}(),Ae={clientId:"",authority:null,validateAuthority:!0,redirectUri:function(){return ue.getDefaultRedirectUri()},postLogoutRedirectUri:function(){return ue.getDefaultRedirectUri()},navigateToLoginRequestUrl:!0},_e={cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},Ne={logger:new Re(null),loadFrameTimeout:6e3,tokenRenewalOffsetSeconds:300,navigateFrameWait:500},Pe={isAngular:!1,unprotectedResources:new Array,protectedResourceMap:new Map};var Ue={code:"server_unavailable",desc:"Server is temporarily unavailable."},xe={code:"unknown_server_error"},De=function(e){function r(t,n){var o=e.call(this,t,n)||this;return o.name="ServerError",Object.setPrototypeOf(o,r.prototype),o}return t(r,e),r.createServerUnavailableError=function(){return new r(Ue.code,Ue.desc)},r.createUnknownServerError=function(e){return new r(xe.code,e)},r}(y),Le={code:"interaction_required"},He={code:"consent_required"},qe={code:"login_required"},Me=function(e){function r(t,n){var o=e.call(this,t,n)||this;return o.name="InteractionRequiredAuthError",Object.setPrototypeOf(o,r.prototype),o}return t(r,e),r.isInteractionRequiredError=function(e){var t=[Le.code,He.code,qe.code];return e&&t.indexOf(e)>-1},r.createLoginRequiredAuthError=function(e){return new r(qe.code,e)},r.createInteractionRequiredAuthError=function(e){return new r(Le.code,e)},r.createConsentRequiredAuthError=function(e){return new r(He.code,e)},r}(De);function je(e){return{uniqueId:"",tenantId:"",tokenType:"",idToken:null,idTokenClaims:null,accessToken:"",scopes:null,expiresOn:null,account:null,accountState:e,fromCache:!1}}var Ge="Microsoft.MSAL.correlation_id",Fe="Microsoft_MSAL_cache_event_count",Ke="Microsoft_MSAL_http_event_count",We="Microsoft_MSAL_ui_event_count",Qe=function(e){return"msal."+(e||"")},Ve=function(e){function r(t,r,n,o){var i=e.call(this,Qe("default_event"),r)||this;return i.event[Qe("client_id")]=n,i.event[Qe("sdk_plaform")]=t.sdk,i.event[Qe("sdk_version")]=t.sdkVersion,i.event[Qe("application_name")]=t.applicationName,i.event[Qe("application_version")]=t.applicationVersion,i.event[""+We]=i.getEventCount(Qe("ui_event"),o),i.event[""+Ke]=i.getEventCount(Qe("http_event"),o),i.event[""+Fe]=i.getEventCount(Qe("cache_event"),o),i}return t(r,e),r.prototype.getEventCount=function(e,t){return t[e]?t[e]:0},r}(function(){function e(e,t){var r;this.startTimestamp=Date.now(),this.eventId=u.createNewGuid(),this.event=((r={})[Qe("event_name")]=e,r[Qe("start_time")]=this.startTimestamp,r[Qe("elapsed_time")]=-1,r[""+Ge]=t,r)}return e.prototype.setElapsedTime=function(e){this.event[Qe("elapsed_time")]=e},e.prototype.stop=function(){this.setElapsedTime(+Date.now()-+this.startTimestamp)},Object.defineProperty(e.prototype,"telemetryCorrelationId",{get:function(){return this.event[""+Ge]},set:function(e){this.event[""+Ge]=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventName",{get:function(){return this.event[Qe("event_name")]},enumerable:!0,configurable:!0}),e.prototype.get=function(){return r({},this.event,{eventId:this.eventId})},e}()),Be=function(e){return e.telemetryCorrelationId+"-"+e.eventId+"-"+e.eventName},Je=function(){function e(e,t){this.completedEvents={},this.inProgressEvents={},this.eventCountByCorrelationId={},this.onlySendFailureTelemetry=!1,this.telemetryPlatform=e.platform,this.clientId=e.clientId,this.onlySendFailureTelemetry=e.onlySendFailureTelemetry,this.telemetryEmitter=t}return e.prototype.startEvent=function(e){if(this.telemetryEmitter){var t=Be(e);this.inProgressEvents[t]=e}},e.prototype.stopEvent=function(e){var t=Be(e);if(this.telemetryEmitter&&this.inProgressEvents[t]){e.stop(),this.incrementEventCount(e);var r=this.completedEvents[e.telemetryCorrelationId];this.completedEvents[e.telemetryCorrelationId]=(r||[]).concat([e]),delete this.inProgressEvents[t]}},e.prototype.flush=function(e){var t=this;if(this.telemetryEmitter&&this.completedEvents[e]){var r=this.getOrphanedEvents(e);r.forEach((function(e){return t.incrementEventCount(e)}));var n=this.completedEvents[e].concat(r);delete this.completedEvents[e];var o=this.eventCountByCorrelationId[e];if(delete this.eventCountByCorrelationId[e],n&&n.length){var i=new Ve(this.telemetryPlatform,e,this.clientId,o),a=n.concat([i]);this.telemetryEmitter(a.map((function(e){return e.get()})))}}},e.prototype.incrementEventCount=function(e){var t,r=e.eventName,n=this.eventCountByCorrelationId[e.telemetryCorrelationId];n?n[r]=n[r]?n[r]+1:1:this.eventCountByCorrelationId[e.telemetryCorrelationId]=((t={})[r]=1,t)},e.prototype.getOrphanedEvents=function(e){var t=this;return Object.keys(this.inProgressEvents).reduce((function(r,n){if(-1!==n.indexOf(e)){var o=t.inProgressEvents[n];return delete t.inProgressEvents[n],r.concat([o])}return r}),[])},e}(),ze="id_token",Ze="token",$e="id_token token",Xe=function(){function e(e){var t,n,o,i,a,c,s,u;this.authResponseCallback=null,this.tokenReceivedCallback=null,this.errorReceivedCallback=null,this.config=(n=(t=e).auth,o=t.cache,i=void 0===o?{}:o,a=t.system,c=void 0===a?{}:a,s=t.framework,u=void 0===s?{}:s,{auth:r({},Ae,n),cache:r({},_e,i),system:r({},Ne,c),framework:r({},Pe,u)}),this.redirectCallbacksSet=!1,this.logger=this.config.system.logger,this.clientId=this.config.auth.clientId,this.inCookie=this.config.cache.storeAuthStateInCookie,this.telemetryManager=this.getTelemetryManagerFromConfig(this.config.system.telemetry,this.clientId),this.authority=this.config.auth.authority||"https://login.microsoftonline.com/common",this.cacheStorage=new Ie(this.clientId,this.config.cache.cacheLocation,this.inCookie),window.activeRenewals={},window.renewStates=[],window.callbackMappedToRenewStates={},window.promiseMappedToRenewStates={},window.msal=this;var l=window.location.hash,h=ue.urlContainsHash(l);ve.checkIfBackButtonIsPressed(this.cacheStorage),!h||ve.isInIframe()||ve.isInPopup()||this.handleAuthenticationResponse(l)}return Object.defineProperty(e.prototype,"authority",{get:function(){return this.authorityInstance.CanonicalAuthority},set:function(e){this.authorityInstance=Oe.CreateInstance(e,this.config.auth.validateAuthority)},enumerable:!0,configurable:!0}),e.prototype.getAuthorityInstance=function(){return this.authorityInstance},e.prototype.handleRedirectCallback=function(e,t){if(!e)throw this.redirectCallbacksSet=!1,ce.createInvalidCallbackObjectError(e);t?(this.tokenReceivedCallback=e,this.errorReceivedCallback=t,this.logger.warning("This overload for callback is deprecated - please change the format of the callbacks to a single callback as shown: (err: AuthError, response: AuthResponse).")):this.authResponseCallback=e,this.redirectCallbacksSet=!0;var r=this.cacheStorage.getItem(a.URL_HASH);r&&this.processCallBack(r,null)},e.prototype.urlContainsHash=function(e){return ue.urlContainsHash(e)},e.prototype.authResponseHandler=function(e,t,r){if(e===l.interactionTypeRedirect)this.errorReceivedCallback?this.tokenReceivedCallback(t):this.authResponseCallback&&this.authResponseCallback(null,t);else{if(e!==l.interactionTypePopup)throw F.createInvalidInteractionTypeError();r(t)}},e.prototype.authErrorHandler=function(e,t,r,n){if(this.cacheStorage.removeItem(a.INTERACTION_STATUS),e===l.interactionTypeRedirect)this.errorReceivedCallback?this.errorReceivedCallback(t,r.accountState):this.authResponseCallback(t,r);else{if(e!==l.interactionTypePopup)throw F.createInvalidInteractionTypeError();n(t)}},e.prototype.loginRedirect=function(e){var t=Ee.validateRequest(e,!0,this.clientId,l.interactionTypeRedirect,this.redirectCallbacksSet);this.acquireTokenInteractive(l.interactionTypeRedirect,!0,t,null,null)},e.prototype.acquireTokenRedirect=function(e){var t=Ee.validateRequest(e,!1,this.clientId,l.interactionTypeRedirect,this.redirectCallbacksSet);this.acquireTokenInteractive(l.interactionTypeRedirect,!1,t,null,null)},e.prototype.loginPopup=function(e){var t=this,r=Ee.validateRequest(e,!0,this.clientId,l.interactionTypePopup);return new Promise((function(e,n){t.acquireTokenInteractive(l.interactionTypePopup,!0,r,e,n)})).catch((function(e){throw t.cacheStorage.resetTempCacheItems(r.state),e}))},e.prototype.acquireTokenPopup=function(e){var t=this,r=Ee.validateRequest(e,!1,this.clientId,l.interactionTypePopup);return new Promise((function(e,n){t.acquireTokenInteractive(l.interactionTypePopup,!1,r,e,n)})).catch((function(e){throw t.cacheStorage.resetTempCacheItems(r.state),e}))},e.prototype.acquireTokenInteractive=function(e,t,r,n,o){var i=this;ve.blockReloadInHiddenIframes();var c=this.cacheStorage.getItem(a.INTERACTION_STATUS);if(e===l.interactionTypeRedirect&&this.cacheStorage.setItem(a.REDIRECT_REQUEST,""+l.inProgress+l.resourceDelimiter+r.state),c===l.inProgress){var s=t?F.createLoginInProgressError():F.createAcquireTokenInProgressError(),u=je(this.getAccountState(r.state));return this.cacheStorage.resetTempCacheItems(r.state),void this.authErrorHandler(e,s,u,o)}var h=r&&r.account&&!t?r.account:this.getAccount();if(h||de.isSSOParam(r))this.acquireTokenHelper(h,e,t,r,n,o);else{if(!t){this.logger.info("User login is required");u=je(this.getAccountState(r.state));return this.cacheStorage.resetTempCacheItems(r.state),void this.authErrorHandler(e,F.createUserLoginRequiredError(),u,o)}if(this.extractADALIdToken()&&!r.scopes){this.logger.info("ADAL's idToken exists. Extracting login information from ADAL's idToken ");var d=this.buildIDTokenRequest(r);this.silentLogin=!0,this.acquireTokenSilent(d).then((function(t){i.silentLogin=!1,i.logger.info("Unified cache call is successful"),i.authResponseHandler(e,t,n)}),(function(a){i.silentLogin=!1,i.logger.error("Error occurred during unified cache ATS: "+a),i.acquireTokenHelper(null,e,t,r,n,o)}))}else this.acquireTokenHelper(null,e,t,r,n,o)}},e.prototype.acquireTokenHelper=function(e,t,r,i,c,u){var h=this;this.cacheStorage.setItem(a.INTERACTION_STATUS,l.inProgress);var d,p,f=i.scopes?i.scopes.join(" ").toLowerCase():this.clientId.toLowerCase(),g=i&&i.authority?Oe.CreateInstance(i.authority,this.config.auth.validateAuthority):this.authorityInstance;if(t===l.interactionTypePopup){try{p=this.openPopup("about:blank","msal",l.popUpWidth,l.popUpHeight),ve.trackPopup(p)}catch(e){this.logger.info(S.code+":"+S.desc),this.cacheStorage.setItem(s.ERROR,S.code),this.cacheStorage.setItem(s.ERROR_DESC,S.desc),u&&u(F.createPopupWindowError())}if(!p)return}g.resolveEndpointsAsync().then((function(){return n(h,void 0,void 0,(function(){var n,s,h,m,I;return o(this,(function(o){switch(o.label){case 0:if(n=r?ze:this.getTokenType(e,i.scopes,!1),r&&((s=this.cacheStorage.getItem(""+a.ANGULAR_LOGIN_REQUEST+l.resourceDelimiter+i.state))&&""!==s?this.cacheStorage.setItem(""+a.ANGULAR_LOGIN_REQUEST+l.resourceDelimiter+i.state,""):s=window.location.href),d=new de(g,this.clientId,n,this.getRedirectUri(i&&i.redirectUri),i.scopes,i.state,i.correlationId),this.updateCacheEntries(d,e,s),d.populateQueryParams(e,i),h=ue.createNavigateUrl(d)+l.response_mode_fragment,t===l.interactionTypeRedirect)r||this.cacheStorage.setItem(""+a.STATE_ACQ_TOKEN+l.resourceDelimiter+i.state,d.state,this.inCookie);else{if(t!==l.interactionTypePopup)throw F.createInvalidInteractionTypeError();window.renewStates.push(d.state),window.requestType=r?l.login:l.renewToken,this.registerCallback(d.state,f,c,u)}if(this.navigateWindow(h,p),!p)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,ve.monitorWindowForHash(p,this.config.system.loadFrameTimeout,h)];case 2:return m=o.sent(),this.handleAuthenticationResponse(m),this.cacheStorage.removeItem(a.INTERACTION_STATUS),this.logger.info("Closing popup window"),this.config.framework.isAngular&&(this.broadcast("msal:popUpHashChanged",m),ve.closePopups()),[3,4];case 3:return I=o.sent(),u&&u(I),this.config.framework.isAngular?this.broadcast("msal:popUpClosed",I.errorCode+l.resourceDelimiter+I.errorMessage):(this.cacheStorage.removeItem(a.INTERACTION_STATUS),p.close()),[3,4];case 4:return[2]}}))}))})).catch((function(e){h.logger.warning("could not resolve endpoints"),h.cacheStorage.resetTempCacheItems(i.state),h.authErrorHandler(t,F.createEndpointResolutionError(e.toString),je(i.state),u),p&&p.close()}))},e.prototype.acquireTokenSilent=function(e){var t=this,r=Ee.validateRequest(e,!1,this.clientId);return new Promise((function(e,n){ve.blockReloadInHiddenIframes();var o=r.scopes.join(" ").toLowerCase(),i=r.account||t.getAccount(),a=t.cacheStorage.getItem(l.adalIdToken);if(!i&&!r.sid&&!r.loginHint&&v.isEmpty(a))return t.logger.info("User login is required"),n(F.createUserLoginRequiredError());var c=t.getTokenType(i,r.scopes,!0),s=new de(Oe.CreateInstance(r.authority,t.config.auth.validateAuthority),t.clientId,c,t.getRedirectUri(r.redirectUri),r.scopes,r.state,r.correlationId);if(de.isSSOParam(r)||i)s.populateQueryParams(i,r);else if(!i&&!v.isEmpty(a)){var u=fe.extractIdToken(a);t.logger.verbose("ADAL's idToken exists. Extracting login information from ADAL's idToken "),s.populateQueryParams(i,null,u)}var h,d,p=r.claimsRequest||s.claimsValue;if(!p&&!r.forceRefresh)try{d=t.getCachedToken(s,i)}catch(e){h=e}if(d)return t.logger.info("Token is already in cache for scope:"+o),e(d),null;if(h)return t.logger.infoPii(h.errorCode+":"+h.errorMessage),n(h),null;var f=void 0;return f=p?"Skipped cache lookup since claims were given.":r.forceRefresh?"Skipped cache lookup since request.forceRefresh option was set to true":"Token is not in cache for scope:"+o,t.logger.verbose(f),s.authorityInstance||(s.authorityInstance=r.authority?Oe.CreateInstance(r.authority,t.config.auth.validateAuthority):t.authorityInstance),s.authorityInstance.resolveEndpointsAsync().then((function(){window.activeRenewals[o]?(t.logger.verbose("Renew token for scope: "+o+" is in progress. Registering callback"),t.registerCallback(window.activeRenewals[o],o,e,n)):r.scopes&&r.scopes.indexOf(t.clientId)>-1&&1===r.scopes.length?(t.logger.verbose("renewing idToken"),t.silentLogin=!0,t.renewIdToken(r.scopes,e,n,i,s)):(t.logger.verbose("renewing accesstoken"),t.renewToken(r.scopes,e,n,i,s))})).catch((function(e){return t.logger.warning("could not resolve endpoints"),n(F.createEndpointResolutionError(e.toString())),null}))})).catch((function(e){throw t.cacheStorage.resetTempCacheItems(r.state),e}))},e.prototype.openPopup=function(e,t,r,n){try{var o=window.screenLeft?window.screenLeft:window.screenX,i=window.screenTop?window.screenTop:window.screenY,c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,u=c/2-r/2+o,l=s/2-n/2+i,h=window.open(e,t,"width="+r+", height="+n+", top="+l+", left="+u);if(!h)throw F.createPopupWindowError();return h.focus&&h.focus(),h}catch(e){throw this.logger.error("error opening popup "+e.message),this.cacheStorage.removeItem(a.INTERACTION_STATUS),F.createPopupWindowError(e.toString())}},e.prototype.loadIframeTimeout=function(e,t,r){return n(this,void 0,void 0,(function(){var n,i,c,s;return o(this,(function(o){switch(o.label){case 0:return n=window.activeRenewals[r],this.logger.verbose("Set loading state to pending for: "+r+":"+n),this.cacheStorage.setItem(""+a.RENEW_STATUS+l.resourceDelimiter+n,l.inProgress),[4,ve.loadFrame(e,t,this.config.system.navigateFrameWait,this.logger)];case 1:i=o.sent(),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,ve.monitorWindowForHash(i.contentWindow,this.config.system.loadFrameTimeout,e)];case 3:return(c=o.sent())&&this.handleAuthenticationResponse(c),[3,5];case 4:throw s=o.sent(),this.cacheStorage.getItem(""+a.RENEW_STATUS+l.resourceDelimiter+n)===l.inProgress&&(this.logger.verbose("Loading frame has timed out after: "+this.config.system.loadFrameTimeout/1e3+" seconds for scope "+r+":"+n),n&&window.callbackMappedToRenewStates[n]&&window.callbackMappedToRenewStates[n](null,s),this.cacheStorage.removeItem(""+a.RENEW_STATUS+l.resourceDelimiter+n)),ve.removeHiddenIframe(i),s;case 5:return ve.removeHiddenIframe(i),[2]}}))}))},e.prototype.navigateWindow=function(e,t){if(!e||v.isEmpty(e))throw this.logger.info("Navigate url is empty"),y.createUnexpectedError("Navigate url is empty");var r=t||window,n=t?"Navigated Popup window to:"+e:"Navigate to:"+e;this.logger.infoPii(n),r.location.assign(e)},e.prototype.registerCallback=function(e,t,r,n){var o=this;window.activeRenewals[t]=e,window.promiseMappedToRenewStates[e]||(window.promiseMappedToRenewStates[e]=[]),window.promiseMappedToRenewStates[e].push({resolve:r,reject:n}),window.callbackMappedToRenewStates[e]||(window.callbackMappedToRenewStates[e]=function(r,n){window.activeRenewals[t]=null;for(var i=0;i<window.promiseMappedToRenewStates[e].length;++i)try{if(n)window.promiseMappedToRenewStates[e][i].reject(n);else{if(!r)throw o.cacheStorage.resetTempCacheItems(e),y.createUnexpectedError("Error and response are both null");window.promiseMappedToRenewStates[e][i].resolve(r)}}catch(e){o.logger.warning(e)}window.promiseMappedToRenewStates[e]=null,window.callbackMappedToRenewStates[e]=null})},e.prototype.logout=function(){var e=this;this.clearCache(),this.account=null;var t="";this.getPostLogoutRedirectUri()&&(t="post_logout_redirect_uri="+encodeURIComponent(this.getPostLogoutRedirectUri())),this.authorityInstance.resolveEndpointsAsync().then((function(r){var n=r.EndSessionEndpoint?r.EndSessionEndpoint+"?"+t:e.authority+"oauth2/v2.0/logout?"+t;e.navigateWindow(n)}))},e.prototype.clearCache=function(){window.renewStates=[];for(var e=this.cacheStorage.getAllAccessTokens(l.clientId,l.homeAccountIdentifier),t=0;t<e.length;t++)this.cacheStorage.removeItem(JSON.stringify(e[t].key));this.cacheStorage.resetCacheItems(),this.cacheStorage.clearMsalCookie()},e.prototype.clearCacheForScope=function(e){for(var t=this.cacheStorage.getAllAccessTokens(l.clientId,l.homeAccountIdentifier),r=0;r<t.length;r++){var n=t[r];n.value.accessToken===e&&this.cacheStorage.removeItem(JSON.stringify(n.key))}},e.prototype.isCallback=function(e){return this.logger.info("isCallback will be deprecated in favor of urlContainsHash in MSAL.js v2.0."),ue.urlContainsHash(e)},e.prototype.processCallBack=function(e,t,r){var n,o;this.logger.info("Processing the callback from redirect response"),t||(t=this.getResponseState(e));try{n=this.saveTokenFromHash(e,t)}catch(e){o=e}this.cacheStorage.removeItem(a.URL_HASH);try{this.cacheStorage.clearMsalCookie(t.state);var c=this.getAccountState(t.state);if(n){if(t.requestType===l.renewToken||n.accessToken?(window.parent!==window?this.logger.verbose("Window is in iframe, acquiring token silently"):this.logger.verbose("acquiring token interactive in progress"),n.tokenType=i.ACCESS_TOKEN):t.requestType===l.login&&(n.tokenType=i.ID_TOKEN),!r)return void this.authResponseHandler(l.interactionTypeRedirect,n)}else if(!r)return this.cacheStorage.resetTempCacheItems(t.state),void this.authErrorHandler(l.interactionTypeRedirect,o,je(c));r(n,o)}catch(e){throw this.logger.error("Error occurred in token received callback function: "+e),F.createErrorInCallbackFunction(e.toString())}},e.prototype.handleAuthenticationResponse=function(e){var t=e||window.location.hash,r=ve.getIframeWithHash(t),n=ve.getPopUpWithHash(t),o=!(!r&&!n),i=this.getResponseState(t),c=null;if(this.logger.info("Returned from redirect url"),o)c=window.callbackMappedToRenewStates[i.state];else{if(c=null,this.config.auth.navigateToLoginRequestUrl){if(this.cacheStorage.setItem(a.URL_HASH,t),window.parent===window){var s=this.cacheStorage.getItem(""+a.LOGIN_REQUEST+l.resourceDelimiter+i.state,this.inCookie);s&&"null"!==s?window.location.href=s:(this.logger.error("Unable to get valid login request url from cache, redirecting to home page"),window.location.href="/")}return}if(window.location.hash="",!this.redirectCallbacksSet)return void this.cacheStorage.setItem(a.URL_HASH,t)}this.processCallBack(t,i,c),o&&ve.closePopups()},e.prototype.getResponseState=function(e){var t,r=ue.deserializeHash(e);if(!r)throw y.createUnexpectedError("Hash was not parsed correctly.");if(!r.hasOwnProperty("state"))throw y.createUnexpectedError("Hash does not contain state.");if((t={requestType:l.unknown,state:r.state,stateMatch:!1}).state===this.cacheStorage.getItem(""+a.STATE_LOGIN+l.resourceDelimiter+t.state,this.inCookie)||t.state===this.silentAuthenticationState)return t.requestType=l.login,t.stateMatch=!0,t;if(t.state===this.cacheStorage.getItem(""+a.STATE_ACQ_TOKEN+l.resourceDelimiter+t.state,this.inCookie))return t.requestType=l.renewToken,t.stateMatch=!0,t;if(!t.stateMatch){t.requestType=window.requestType;for(var n=window.renewStates,o=0;o<n.length;o++)if(n[o]===t.state){t.stateMatch=!0;break}}return t},e.prototype.getCachedToken=function(e,t){var r=null,n=e.scopes,o=this.cacheStorage.getAllAccessTokens(this.clientId,t?t.homeAccountIdentifier:null);if(0===o.length)return null;var a=[];if(e.authority){for(c=0;c<o.length;c++){u=(s=o[c]).key.scopes.split(" ");se.containsScope(u,n)&&ue.CanonicalizeUri(s.key.authority)===e.authority&&a.push(s)}if(0===a.length)return null;if(1!==a.length)throw F.createMultipleMatchingTokensInCacheError(n.toString());r=a[0]}else{for(var c=0;c<o.length;c++){var s,u=(s=o[c]).key.scopes.split(" ");se.containsScope(u,n)&&a.push(s)}if(1===a.length)r=a[0],e.authorityInstance=Oe.CreateInstance(r.key.authority,this.config.auth.validateAuthority);else{if(a.length>1)throw F.createMultipleMatchingTokensInCacheError(n.toString());var l=this.getUniqueAuthority(o,"authority");if(l.length>1)throw F.createMultipleAuthoritiesInCacheError(n.toString());e.authorityInstance=Oe.CreateInstance(l[0],this.config.auth.validateAuthority)}}if(null!=r){var h=Number(r.value.expiresIn),d=this.config.system.tokenRenewalOffsetSeconds||300;if(h&&h>we.now()+d){var p=new ge(r.value.idToken);if(!t&&!(t=this.getAccount()))throw y.createUnexpectedError("Account should not be null here.");var f=this.getAccountState(e.state),g={uniqueId:"",tenantId:"",tokenType:r.value.idToken===r.value.accessToken?i.ID_TOKEN:i.ACCESS_TOKEN,idToken:p,idTokenClaims:p.claims,accessToken:r.value.accessToken,scopes:r.key.scopes.split(" "),expiresOn:new Date(1e3*h),account:t,accountState:f,fromCache:!0};return Te.setResponseIdToken(g,p),g}return this.cacheStorage.removeItem(JSON.stringify(a[0].key)),null}return null},e.prototype.getUniqueAuthority=function(e,t){var r=[],n=[];return e.forEach((function(e){e.key.hasOwnProperty(t)&&-1===n.indexOf(e.key[t])&&(n.push(e.key[t]),r.push(e.key[t]))})),r},e.prototype.extractADALIdToken=function(){var e=this.cacheStorage.getItem(l.adalIdToken);return v.isEmpty(e)?null:fe.extractIdToken(e)},e.prototype.renewToken=function(e,t,r,n,o){var i=e.join(" ").toLowerCase();this.logger.verbose("renewToken is called for scope:"+i);var a="msalRenewFrame"+i,c=ve.addHiddenIFrame(a,this.logger);this.updateCacheEntries(o,n),this.logger.verbose("Renew token Expected state: "+o.state);var s=ue.urlRemoveQueryStringParameter(ue.createNavigateUrl(o),l.prompt)+l.prompt_none+l.response_mode_fragment;window.renewStates.push(o.state),window.requestType=l.renewToken,this.registerCallback(o.state,i,t,r),this.logger.infoPii("Navigate to:"+s),c.src="about:blank",this.loadIframeTimeout(s,a,i).catch((function(e){return r(e)}))},e.prototype.renewIdToken=function(e,t,r,n,o){this.logger.info("renewidToken is called");var i=ve.addHiddenIFrame("msalIdTokenFrame",this.logger);this.updateCacheEntries(o,n),this.logger.verbose("Renew Idtoken Expected state: "+o.state);var a=ue.urlRemoveQueryStringParameter(ue.createNavigateUrl(o),l.prompt)+l.prompt_none+l.response_mode_fragment;this.silentLogin?(window.requestType=l.login,this.silentAuthenticationState=o.state):(window.requestType=l.renewToken,window.renewStates.push(o.state)),this.registerCallback(o.state,this.clientId,t,r),this.logger.infoPii("Navigate to:"+a),i.src="about:blank",this.loadIframeTimeout(a,"msalIdTokenFrame",this.clientId).catch((function(e){return r(e)}))},e.prototype.saveAccessToken=function(e,t,n,o,a){var c,s,u=r({},e),l=new pe(o);if(n.hasOwnProperty(i.SCOPE)){for(var h=(c=n[i.SCOPE]).split(" "),d=this.cacheStorage.getAllAccessTokens(this.clientId,t),p=0;p<d.length;p++){var f=d[p];if(f.key.homeAccountIdentifier===e.account.homeAccountIdentifier){var g=f.key.scopes.split(" ");se.isIntersectingScopes(g,h)&&this.cacheStorage.removeItem(JSON.stringify(f.key))}}var m=we.parseExpiresIn(n[i.EXPIRES_IN]);s=we.now()+m;var I=new le(t,this.clientId,c,l.uid,l.utid),y=new he(n[i.ACCESS_TOKEN],a.rawIdToken,s.toString(),o);this.cacheStorage.setItem(JSON.stringify(I),JSON.stringify(y)),u.accessToken=n[i.ACCESS_TOKEN],u.scopes=h}else{c=this.clientId;I=new le(t,this.clientId,c,l.uid,l.utid);s=Number(a.expiration);y=new he(n[i.ID_TOKEN],n[i.ID_TOKEN],s.toString(),o);this.cacheStorage.setItem(JSON.stringify(I),JSON.stringify(y)),u.scopes=[c],u.accessToken=n[i.ID_TOKEN]}return s?u.expiresOn=new Date(1e3*s):this.logger.error("Could not parse expiresIn parameter"),u},e.prototype.saveTokenFromHash=function(e,t){this.logger.info("State status:"+t.stateMatch+"; Request type:"+t.requestType);var r,n={uniqueId:"",tenantId:"",tokenType:"",idToken:null,idTokenClaims:null,accessToken:null,scopes:[],expiresOn:null,account:null,accountState:"",fromCache:!1},o=ue.deserializeHash(e),u="",h="",d=null;if(o.hasOwnProperty(i.ERROR_DESCRIPTION)||o.hasOwnProperty(i.ERROR)){if(this.logger.infoPii("Error :"+o[i.ERROR]+"; Error description:"+o[i.ERROR_DESCRIPTION]),this.cacheStorage.setItem(s.ERROR,o[i.ERROR]),this.cacheStorage.setItem(s.ERROR_DESC,o[i.ERROR_DESCRIPTION]),t.requestType===l.login&&(this.cacheStorage.setItem(s.LOGIN_ERROR,o[i.ERROR_DESCRIPTION]+":"+o[i.ERROR]),u=Ie.generateAuthorityKey(t.state)),t.requestType===l.renewToken){u=Ie.generateAuthorityKey(t.state);var p=this.getAccount(),f=void 0;f=p&&!v.isEmpty(p.homeAccountIdentifier)?p.homeAccountIdentifier:l.no_account,h=Ie.generateAcquireTokenAccountKey(f,t.state)}var g=o[i.ERROR],m=o[i.ERROR_DESCRIPTION];r=Me.isInteractionRequiredError(g)||Me.isInteractionRequiredError(m)?new Me(o[i.ERROR],o[i.ERROR_DESCRIPTION]):new De(o[i.ERROR],o[i.ERROR_DESCRIPTION])}else if(t.stateMatch){this.logger.info("State is right"),o.hasOwnProperty(i.SESSION_STATE)&&this.cacheStorage.setItem(""+a.SESSION_STATE+l.resourceDelimiter+t.state,o[i.SESSION_STATE]),n.accountState=this.getAccountState(t.state);var I="";if(o.hasOwnProperty(i.ACCESS_TOKEN)){this.logger.info("Fragment has access token"),o.hasOwnProperty(i.ID_TOKEN)?(d=new ge(o[i.ID_TOKEN]),n.idToken=d,n.idTokenClaims=d.claims):(d=new ge(this.cacheStorage.getItem(c.IDTOKEN)),n=Te.setResponseIdToken(n,d));var w=this.populateAuthority(t.state,this.inCookie,this.cacheStorage,d);if(!o.hasOwnProperty(i.CLIENT_INFO))throw this.logger.warning("ClientInfo not received in the response from AAD"),F.createClientInfoNotPopulatedError("ClientInfo not received in the response from the server");I=o[i.CLIENT_INFO],n.account=ye.createAccount(d,new pe(I));var E=void 0;E=n.account&&!v.isEmpty(n.account.homeAccountIdentifier)?n.account.homeAccountIdentifier:l.no_account,h=Ie.generateAcquireTokenAccountKey(E,t.state);var T=Ie.generateAcquireTokenAccountKey(l.no_account,t.state),S=this.cacheStorage.getItem(h),C=void 0;v.isEmpty(S)?v.isEmpty(this.cacheStorage.getItem(T))||(n=this.saveAccessToken(n,w,o,I,d)):(C=JSON.parse(S),n.account&&C&&ye.compareAccounts(n.account,C)?(n=this.saveAccessToken(n,w,o,I,d),this.logger.info("The user object received in the response is the same as the one passed in the acquireToken request")):this.logger.warning("The account object created from the response is not the same as the one passed in the acquireToken request"))}if(o.hasOwnProperty(i.ID_TOKEN)){this.logger.info("Fragment has id token"),d=new ge(o[i.ID_TOKEN]),n=Te.setResponseIdToken(n,d),o.hasOwnProperty(i.CLIENT_INFO)?I=o[i.CLIENT_INFO]:this.logger.warning("ClientInfo not received in the response from AAD");w=this.populateAuthority(t.state,this.inCookie,this.cacheStorage,d);this.account=ye.createAccount(d,new pe(I)),n.account=this.account,d&&d.nonce?d.nonce!==this.cacheStorage.getItem(""+a.NONCE_IDTOKEN+l.resourceDelimiter+t.state,this.inCookie)?(this.account=null,this.cacheStorage.setItem(s.LOGIN_ERROR,"Nonce Mismatch. Expected Nonce: "+this.cacheStorage.getItem(""+a.NONCE_IDTOKEN+l.resourceDelimiter+t.state,this.inCookie)+",Actual Nonce: "+d.nonce),this.logger.error("Nonce Mismatch.Expected Nonce: "+this.cacheStorage.getItem(""+a.NONCE_IDTOKEN+l.resourceDelimiter+t.state,this.inCookie)+",Actual Nonce: "+d.nonce),r=F.createNonceMismatchError(this.cacheStorage.getItem(""+a.NONCE_IDTOKEN+l.resourceDelimiter+t.state,this.inCookie),d.nonce)):(this.cacheStorage.setItem(c.IDTOKEN,o[i.ID_TOKEN]),this.cacheStorage.setItem(c.CLIENT_INFO,I),this.saveAccessToken(n,w,o,I,d)):(u=t.state,h=t.state,this.logger.error("Invalid id_token received in the response"),r=F.createInvalidIdTokenError(d),this.cacheStorage.setItem(s.ERROR,r.errorCode),this.cacheStorage.setItem(s.ERROR_DESC,r.errorMessage))}}else{u=t.state,h=t.state;var k=this.cacheStorage.getItem(""+a.STATE_LOGIN+l.resourceDelimiter+t.state,this.inCookie);this.logger.error("State Mismatch.Expected State: "+k+",Actual State: "+t.state),r=F.createInvalidStateError(t.state,k),this.cacheStorage.setItem(s.ERROR,r.errorCode),this.cacheStorage.setItem(s.ERROR_DESC,r.errorMessage)}if(this.cacheStorage.removeItem(""+a.RENEW_STATUS+l.resourceDelimiter+t.state),this.cacheStorage.resetTempCacheItems(t.state),this.inCookie&&(this.cacheStorage.setItemCookie(u,"",-1),this.cacheStorage.clearMsalCookie(t.state)),r)throw r;if(!n)throw y.createUnexpectedError("Response is null");return n},e.prototype.populateAuthority=function(e,t,r,n){var o=Ie.generateAuthorityKey(e),i=r.getItem(o,t);return v.isEmpty(i)?i:ue.replaceTenantPath(i,n.tenantId)},e.prototype.getAccount=function(){if(this.account)return this.account;var e=this.cacheStorage.getItem(c.IDTOKEN),t=this.cacheStorage.getItem(c.CLIENT_INFO);if(!v.isEmpty(e)&&!v.isEmpty(t)){var r=new ge(e),n=new pe(t);return this.account=ye.createAccount(r,n),this.account}return null},e.prototype.getAccountState=function(e){if(e){var t=e.indexOf("|");if(t>-1&&t+1<e.length)return e.substring(t+1)}return e},e.prototype.getAllAccounts=function(){for(var e=[],t=this.cacheStorage.getAllAccessTokens(l.clientId,l.homeAccountIdentifier),r=0;r<t.length;r++){var n=new ge(t[r].value.idToken),o=new pe(t[r].value.homeAccountIdentifier),i=ye.createAccount(n,o);e.push(i)}return this.getUniqueAccounts(e)},e.prototype.getUniqueAccounts=function(e){if(!e||e.length<=1)return e;for(var t=[],r=[],n=0;n<e.length;++n)e[n].homeAccountIdentifier&&-1===t.indexOf(e[n].homeAccountIdentifier)&&(t.push(e[n].homeAccountIdentifier),r.push(e[n]));return r},e.prototype.broadcast=function(e,t){var r=new CustomEvent(e,{detail:t});window.dispatchEvent(r)},e.prototype.getCachedTokenInternal=function(e,t,r,n){var o=t||this.getAccount();if(!o)return null;var i=this.authorityInstance?this.authorityInstance:Oe.CreateInstance(this.authority,this.config.auth.validateAuthority),a=this.getTokenType(o,e,!0),c=new de(i,this.clientId,a,this.getRedirectUri(),e,r,n);return this.getCachedToken(c,t)},e.prototype.getScopesForEndpoint=function(e){if(this.config.framework.unprotectedResources.length>0)for(var t=0;t<this.config.framework.unprotectedResources.length;t++)if(e.indexOf(this.config.framework.unprotectedResources[t])>-1)return null;if(this.config.framework.protectedResourceMap.size>0)for(var r=0,n=Array.from(this.config.framework.protectedResourceMap.keys());r<n.length;r++){var o=n[r];if(e.indexOf(o)>-1)return this.config.framework.protectedResourceMap.get(o)}return e.indexOf("http://")>-1||e.indexOf("https://")>-1?ue.getHostFromUri(e)===ue.getHostFromUri(this.getRedirectUri())?new Array(this.clientId):null:new Array(this.clientId)},e.prototype.getLoginInProgress=function(){return!!this.cacheStorage.getItem(a.URL_HASH)||this.cacheStorage.getItem(a.INTERACTION_STATUS)===l.inProgress},e.prototype.setInteractionInProgress=function(e){e?this.cacheStorage.setItem(a.INTERACTION_STATUS,l.inProgress):this.cacheStorage.removeItem(a.INTERACTION_STATUS)},e.prototype.setloginInProgress=function(e){this.setInteractionInProgress(e)},e.prototype.getAcquireTokenInProgress=function(){return this.cacheStorage.getItem(a.INTERACTION_STATUS)===l.inProgress},e.prototype.setAcquireTokenInProgress=function(e){this.setInteractionInProgress(e)},e.prototype.getLogger=function(){return this.config.system.logger},e.prototype.getRedirectUri=function(e){return e||("function"==typeof this.config.auth.redirectUri?this.config.auth.redirectUri():this.config.auth.redirectUri)},e.prototype.getPostLogoutRedirectUri=function(){return"function"==typeof this.config.auth.postLogoutRedirectUri?this.config.auth.postLogoutRedirectUri():this.config.auth.postLogoutRedirectUri},e.prototype.getCurrentConfiguration=function(){if(!this.config)throw ce.createNoSetConfigurationError();return this.config},e.prototype.getTokenType=function(e,t,r){return r?ye.compareAccounts(e,this.getAccount())?t.indexOf(this.config.auth.clientId)>-1?ze:Ze:t.indexOf(this.config.auth.clientId)>-1?ze:$e:ye.compareAccounts(e,this.getAccount())?t.indexOf(this.clientId)>-1?ze:Ze:$e},e.prototype.setAccountCache=function(e,t){var r=e?this.getAccountId(e):l.no_account,n=Ie.generateAcquireTokenAccountKey(r,t);this.cacheStorage.setItem(n,JSON.stringify(e))},e.prototype.setAuthorityCache=function(e,t){var r=Ie.generateAuthorityKey(e);this.cacheStorage.setItem(r,ue.CanonicalizeUri(t),this.inCookie)},e.prototype.updateCacheEntries=function(e,t,r){r?(this.cacheStorage.setItem(""+a.LOGIN_REQUEST+l.resourceDelimiter+e.state,r,this.inCookie),this.cacheStorage.setItem(""+a.STATE_LOGIN+l.resourceDelimiter+e.state,e.state,this.inCookie)):this.setAccountCache(t,e.state),this.setAuthorityCache(e.state,e.authority),this.cacheStorage.setItem(""+a.NONCE_IDTOKEN+l.resourceDelimiter+e.state,e.nonce,this.inCookie)},e.prototype.getAccountId=function(e){return v.isEmpty(e.homeAccountIdentifier)?l.no_account:e.homeAccountIdentifier},e.prototype.buildIDTokenRequest=function(e){return{scopes:[this.clientId],authority:this.authority,account:this.getAccount(),extraQueryParameters:e.extraQueryParameters}},e.prototype.getTelemetryManagerFromConfig=function(e,t){if(!e)return null;var r=e.applicationName,n=e.applicationVersion,o=e.telemetryEmitter;if(!r||!n||!o)throw ce.createTelemetryConfigError(e);return new Je({platform:{sdk:"msal.js",sdkVersion:"1.2.1",applicationName:r,applicationVersion:n},clientId:t},o)},e}();class Ye{constructor(e){this.clientId=e,this.requestObj={scopes:["user.read"]},this.graphConfig={graphMeEndpoint:"https://graph.microsoft.com/v1.0/me"},this.resolve=null,this.reject=null,this.app=null}signIn(){return this.resolve=null,this.reject=null,new Promise((e,t)=>{this.resolve=e,this.reject=t,this.signInWithMsal()})}loadDependencies(){return Promise.resolve()}signInWithMsal(){const e={auth:{clientId:this.clientId,authority:"https://login.microsoftonline.com/common/"},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!0}};this.app=new Xe(e),this.app.handleRedirectCallback((e,t)=>this.redirectCallback(e,t)),this.app.loginPopup(this.requestObj).then(e=>this.signInSucceeded(e)).catch(e=>this.signInFailed(e))}signInSucceeded(e){const t=this.getLoginResult(e);this.getAccessToken(e).then(e=>t.providerData?t.providerData.accessToken=e:e).then(e=>this.getUserPhoto(e)).then(e=>t.imageUrl=e).catch(e=>console.log("Unable to fetch user profile image. Note that Microsoft Graph cannot fetch profile pictures for personal accounts; only work and education accounts are supported. Error details: ",e)).finally(()=>{var e;return null===(e=this.resolve)||void 0===e?void 0:e.call(this,t)})}signInFailed(e){var t;null===(t=this.reject)||void 0===t||t.call(this,e)}redirectCallback(e,t){t?this.signInSucceeded(t):this.signInFailed(e||"Unexpected redirect: no error and no login response")}getAccessToken(e){return this.app?this.app.acquireTokenSilent(this.requestObj).then(e=>e.accessToken):Promise.reject("No app context")}getUserPhoto(e){return this.callGraphApi("/photo/$value",e).then(e=>e.blob()).then(e=>this.getImageUrlFromBlob(e))}callGraphApi(e,t){const r=`${this.graphConfig.graphMeEndpoint}${e}`;return fetch(r,{method:"GET",headers:new Headers({Authorization:`Bearer ${t}`})}).then(t=>404==t.status?Promise.reject(`Graph API returned 404 for ${e}`):t)}getImageUrlFromBlob(e){return new Promise((t,r)=>{const n=new FileReader;n.addEventListener("error",e=>r(e)),n.addEventListener("loadend",()=>t(n.result)),n.readAsDataURL(e)})}getLoginResult(e){var t,r;return{name:(null===(t=e.account)||void 0===t?void 0:t.name)||"",email:(null===(r=e.account)||void 0===r?void 0:r.userName)||"",provider:"Microsoft",accessToken:e.accessToken,accessTokenExpiration:e.expiresOn,error:null,imageUrl:null,providerData:e}}}export{Ye as MicrosoftProvider};
